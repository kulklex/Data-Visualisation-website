<!DOCTYPE html>
<html>

<head>
    <title>WebSocket</title>
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js" charset="utf-8"></script>
</head>

<body>

    <h1>Arsenal data from Server</h1>
   
    <div id="tester"></div>

    <script>
        //Open connection
        let connection = new WebSocket("wss://3b588j212a.execute-api.us-east-1.amazonaws.com/production");
        
       
        //Log connected response
        connection.onopen = function (event) {
            sendMessage()
            console.log("Connected: " + JSON.stringify(event));
        };
        
        //Output messages from the server
        connection.onmessage = function (msg) {
            console.log(msg);
            const result = JSON.parse(msg.data).actual
            var data = [
                {
                    x: result.x,
                    y: result.y,
                    type: 'scatter'
                }
            ];
            Plotly.newPlot(document.getElementById('tester'), data);

            console.log("Message received.");
        }

        //Log errors
        connection.onerror = function (error) {
            console.log("WebSocket Error: " + JSON.stringify(error));
        }

        //Send message to server
        function sendMessage() {

            //Create message to be sent to server
            let msgObject = {
                action: "sendMessage",//Used for routing in API Gateway
                data: 'Arsenal'
            };

            //Send message
            connection.send(JSON.stringify(msgObject));

            //Log result
            console.log("Message sent: " + JSON.stringify(msgObject));
        }


    </script>
</body>

</html>